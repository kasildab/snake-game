<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake Game</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #0b1020, #1f2a44);
    font-family: Arial, sans-serif;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
  }

  .top-bar {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    margin: 10px 0;
  }

  .score {
    font-size: 5vw; /* scales with viewport */
    font-weight: bold;
    color: #7efc6d;
  }

  button {
    padding: 10px 18px;
    font-size: 4vw;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    font-weight: bold;
  }

  .start { background: #4caf50; }
  .pause { background: #f0a500; }
  .reset { background: #e53935; }

  canvas {
    background: #081020;
    border: 3px solid #7efc6d;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(126,252,109,0.6);
    margin: 10px 0;
    width: 90vw;
    height: 90vw; /* square canvas */
    max-width: 600px;
    max-height: 600px;
  }

  .mobile-controls {
    display: none;
    margin-top: 15px;
    flex-direction: column;
    align-items: center;
    gap: 10px;
  }

  .mobile-controls .row {
    display: flex;
    gap: 10px;
  }

  .mobile-btn {
    padding: 12px 18px;
    font-size: 8vw;
    border-radius: 10px;
    border: none;
    background: #4a6cf7;
    color: white;
  }

  @media (max-width: 768px) {
    .mobile-controls { display: flex; }
    canvas { width: 95vw; height: 95vw; }
  }

</style>
</head>
<body>

<div class="top-bar">
  <div class="score">Score: <span id="score">0</span></div>
  <button class="start" id="startBtn">Start</button>
  <button class="pause" id="pauseBtn">Pause</button>
  <button class="reset" id="resetBtn">Reset</button>
</div>

<canvas id="game"></canvas>

<div class="mobile-controls">
  <div class="row">
    <button class="mobile-btn" data-dir="Up">↑</button>
  </div>
  <div class="row">
    <button class="mobile-btn" data-dir="Left">←</button>
    <button class="mobile-btn" data-dir="Down">↓</button>
    <button class="mobile-btn" data-dir="Right">→</button>
  </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");
const startBtn = document.getElementById("startBtn");
const pauseBtn = document.getElementById("pauseBtn");
const resetBtn = document.getElementById("resetBtn");
const mobileBtns = document.querySelectorAll(".mobile-btn");

let grid, count = 0, snake, apple;
let nextDirection = null;
let gameRunning = false;
let animationId;

function resizeCanvas() {
  const size = Math.min(window.innerWidth * 0.9, window.innerHeight * 0.7);
  canvas.width = size;
  canvas.height = size;

  grid = Math.floor(size / 25); // dynamic grid size
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

function initGame() {
  snake = {
    x: grid * 5,
    y: grid * 5,
    dx: grid,
    dy: 0,
    cells: [],
    maxCells: 4
  };
  scoreEl.textContent = 0;
  nextDirection = null;
  placeApple();
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min)) + min;
}

function placeApple() {
  let valid = false;
  while (!valid) {
    apple = {
      x: getRandomInt(0, Math.floor(canvas.width / grid)) * grid,
      y: getRandomInt(0, Math.floor(canvas.height / grid)) * grid
    };
    valid = !snake.cells.some(cell => cell.x === apple.x && cell.y === apple.y);
  }
}

function loop() {
  if (!gameRunning) return;
  animationId = requestAnimationFrame(loop);
  if (++count < 5) return;
  count = 0;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (nextDirection) {
    if (nextDirection === "Up" && snake.dy === 0) { snake.dy = -grid; snake.dx = 0; }
    if (nextDirection === "Down" && snake.dy === 0) { snake.dy = grid; snake.dx = 0; }
    if (nextDirection === "Left" && snake.dx === 0) { snake.dx = -grid; snake.dy = 0; }
    if (nextDirection === "Right" && snake.dx === 0) { snake.dx = grid; snake.dy = 0; }
    nextDirection = null;
  }

  snake.x += snake.dx;
  snake.y += snake.dy;

  if (snake.x < 0) snake.x = canvas.width - grid;
  if (snake.x >= canvas.width) snake.x = 0;
  if (snake.y < 0) snake.y = canvas.height - grid;
  if (snake.y >= canvas.height) snake.y = 0;

  snake.cells.unshift({ x: snake.x, y: snake.y });
  if (snake.cells.length > snake.maxCells) snake.cells.pop();

  ctx.fillStyle = "red";
  ctx.fillRect(apple.x, apple.y, grid - 1, grid - 1);

  ctx.fillStyle = "#7efc6d";
  snake.cells.forEach((cell, index) => {
    ctx.fillRect(cell.x, cell.y, grid - 1, grid - 1);


    for (let i = index + 1; i < snake.cells.length; i++) {
      if (cell.x === snake.cells[i].x && cell.y === snake.cells[i].y) gameRunning = false;
    }

    if (cell.x === apple.x && cell.y === apple.y) {
      snake.maxCells++;
      scoreEl.textContent = parseInt(scoreEl.textContent) + 1;
      placeApple();
    }
  });
}

startBtn.onclick = () => { if (!gameRunning) { gameRunning = true; loop(); } };
pauseBtn.onclick = () => gameRunning = false;
resetBtn.onclick = () => { gameRunning = false; initGame(); };

document.addEventListener("keydown", e => {
  if (e.key === "ArrowUp") nextDirection = "Up";
  if (e.key === "ArrowDown") nextDirection = "Down";
  if (e.key === "ArrowLeft") nextDirection = "Left";
  if (e.key === "ArrowRight") nextDirection = "Right";
});


mobileBtns.forEach(btn => { btn.onclick = () => nextDirection = btn.dataset.dir; });

initGame();
</script>
</body>
</html>
